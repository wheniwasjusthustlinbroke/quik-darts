{
  "rules": {
    "matchmaking_queue": {
      ".read": true,
      ".indexOn": ["timestamp"],
      "$playerId": {
        ".write": true,
        ".validate": "!newData.exists() || (newData.hasChildren(['playerId', 'name', 'flag', 'timestamp']) && newData.child('playerId').val() === $playerId && newData.child('name').isString() && newData.child('name').val().length >= 1 && newData.child('name').val().length <= 20 && newData.child('flag').isString() && newData.child('flag').val().length <= 10)"
      }
    },
    "games": {
      ".read": true,
      ".indexOn": ["player1/id", "createdAt"],
      "$roomId": {
        ".write": true,
        ".validate": "newData.hasChildren(['player1', 'player2', 'currentPlayer', 'status', 'createdAt'])",
        "player1": {
          "score": { ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 501" },
          "name": { ".validate": "newData.isString() && newData.val().length <= 20" }
        },
        "player2": {
          "score": { ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 501" },
          "name": { ".validate": "newData.isString() && newData.val().length <= 20" }
        },
        "currentPlayer": { ".validate": "newData.isNumber() && (newData.val() === 0 || newData.val() === 1)" },
        "dartsThrown": { ".validate": "newData.isNumber() && newData.val() >= 0 && newData.val() <= 3" },
        "status": { ".validate": "newData.isString() && (newData.val() === 'playing' || newData.val() === 'finished')" }
      }
    },
    "weekly_completions": {
      "$challengeId": {
        ".read": true,
        ".write": true,
        ".validate": "!newData.exists() || newData.isNumber()"
      }
    },
    "$other": {
      ".read": false,
      ".write": false
    }
  }
}
